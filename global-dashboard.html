<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Global Stats – ImpactTrack</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <script type="module">
    import { requireAuth, setupNav } from './auth-common.js';
    import { listenToGlobalStats } from './firestore/stats.js';
    import { getAllActivities } from './firestore/activities.js';

    requireAuth();
    setupNav();

    // Global stats
    listenToGlobalStats(stats => {
      document.getElementById('total-compost').textContent = stats.totalCompostKg;
      document.getElementById('total-cleanup').textContent = stats.totalCleanupMinutes;
      document.getElementById('user-count').textContent   = stats.totalUsers;
    });

    // Global activity feed
    getAllActivities(activities => {
      const feed = document.getElementById('activity-feed');
      feed.innerHTML = '';
      activities.forEach(data => {
        const item = document.createElement('div');
        const date = data.createdAt?.toDate().toLocaleString();
        item.textContent = `${data.username}: ${data.amount} ${data.unit} ${data.type} – ${data.note} – ${date}`;
        feed.appendChild(item);
      });
    });
  </script>

  <h1>Global Stats</h1>
  <div id="global-stats">
    <p>Total composted: <span id="total-compost">0</span> kg</p>
    <p>Total cleanup: <span id="total-cleanup">0</span> mins</p>
    <p>Total users: <span id="user-count">0</span></p>
  </div>

  <h2>Recent Activities</h2>
  <div id="activity-feed"></div>

</body>
</html>
